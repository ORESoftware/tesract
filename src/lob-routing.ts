export type OrdersAndPartners = {
  "orders": [
    {
      "id": "order_1",
      "resource": "postcards",
      "address": {
        "latitude": 41.005544,
        "longitude": -73.876138
      }
    },
    {
      "id": "order_2",
      "resource": "postcards",
      "address": {
        "latitude": 28.7024,
        "longitude": -81.452995
      }
    },
    {
      "id": "order_3",
      "resource": "postcards",
      "address": {
        "latitude": 37.961643,
        "longitude": -107.885334
      }
    },
    {
      "id": "order_4",
      "resource": "checks",
      "address": {
        "latitude": 37.928943,
        "longitude": -107.859192
      }
    },
    {
      "id": "order_5",
      "resource": "letters",
      "address": {
        "latitude": 33.04665,
        "longitude": -117.250184
      }
    },
    {
      "id": "order_6",
      "resource": "postcards",
      "address": {
        "latitude": 39.891943,
        "longitude": -75.699625
      }
    },
    {
      "id": "order_7",
      "resource": "letters",
      "address": {
        "latitude": 34.436576,
        "longitude": -119.163465
      }
    },
    {
      "id": "order_8",
      "resource": "letters",
      "address": {
        "latitude": 30.211633,
        "longitude": -97.938092
      }
    },
    {
      "id": "order_9",
      "resource": "checks",
      "address": {
        "latitude": 35.262878,
        "longitude": -82.140506
      }
    },
    {
      "id": "order_10",
      "resource": "checks",
      "address": {
        "latitude": 33.446482,
        "longitude": -83.198236
      }
    },
    {
      "id": "order_11",
      "resource": "letters",
      "address": {
        "latitude": 32.891607,
        "longitude": -96.823646
      }
    },
    {
      "id": "order_12",
      "resource": "postcards",
      "address": {
        "latitude": 33.675769,
        "longitude": -111.850623
      }
    },
    {
      "id": "order_13",
      "resource": "letters",
      "address": {
        "latitude": 26.62785,
        "longitude": -80.218898
      }
    },
    {
      "id": "order_14",
      "resource": "letters",
      "address": {
        "latitude": 34.18078,
        "longitude": -118.806614
      }
    },
    {
      "id": "order_15",
      "resource": "letters",
      "address": {
        "latitude": 34.18078,
        "longitude": -118.806614
      }
    },
    {
      "id": "order_16",
      "resource": "letters",
      "address": {
        "latitude": 32.891607,
        "longitude": -96.823646
      }
    },
    {
      "id": "order_17",
      "resource": "postcards",
      "address": {
        "latitude": 45.868978,
        "longitude": -111.058772
      }
    },
    {
      "id": "order_18",
      "resource": "checks",
      "address": {
        "latitude": 40.046623,
        "longitude": -74.048201
      }
    },
    {
      "id": "order_19",
      "resource": "letters",
      "address": {
        "latitude": 33.675769,
        "longitude": -111.850623
      }
    },
    {
      "id": "order_20",
      "resource": "checks",
      "address": {
        "latitude": 37.958991,
        "longitude": -107.873763
      }
    },
    {
      "id": "order_21",
      "resource": "checks",
      "address": {
        "latitude": 47.618555,
        "longitude": -122.28382
      }
    },
    {
      "id": "order_22",
      "resource": "checks",
      "address": {
        "latitude": 40.763951,
        "longitude": -73.967857
      }
    },
    {
      "id": "order_23",
      "resource": "postcards",
      "address": {
        "latitude": 33.628883,
        "longitude": -117.954707
      }
    },
    {
      "id": "order_24",
      "resource": "checks",
      "address": {
        "latitude": 33.685758,
        "longitude": -116.399214
      }
    },
    {
      "id": "order_25",
      "resource": "letters",
      "address": {
        "latitude": 39.309428,
        "longitude": -74.52928
      }
    },
    {
      "id": "order_26",
      "resource": "letters",
      "address": {
        "latitude": 29.525413,
        "longitude": -95.212941
      }
    },
    {
      "id": "order_27",
      "resource": "checks",
      "address": {
        "latitude": 42.497946,
        "longitude": -71.374363
      }
    },
    {
      "id": "order_28",
      "resource": "letters",
      "address": {
        "latitude": 25.854061,
        "longitude": -80.144928
      }
    },
    {
      "id": "order_29",
      "resource": "letters",
      "address": {
        "latitude": 34.470627,
        "longitude": -119.990909
      }
    },
    {
      "id": "order_30",
      "resource": "letters",
      "address": {
        "latitude": 26.750975,
        "longitude": -80.036365
      }
    },
    {
      "id": "order_31",
      "resource": "postcards",
      "address": {
        "latitude": 32.893501,
        "longitude": -96.825466
      }
    },
    {
      "id": "order_32",
      "resource": "postcards",
      "address": {
        "latitude": 36.592363,
        "longitude": -121.957976
      }
    },
    {
      "id": "order_33",
      "resource": "letters",
      "address": {
        "latitude": 26.102093,
        "longitude": -81.788913
      }
    },
    {
      "id": "order_34",
      "resource": "letters",
      "address": {
        "latitude": 40.733666,
        "longitude": -111.532391
      }
    },
    {
      "id": "order_35",
      "resource": "postcards",
      "address": {
        "latitude": 43.120214,
        "longitude": -89.378063
      }
    },
    {
      "id": "order_36",
      "resource": "postcards",
      "address": {
        "latitude": 32.893652,
        "longitude": -96.819079
      }
    },
    {
      "id": "order_37",
      "resource": "postcards",
      "address": {
        "latitude": 40.554752,
        "longitude": -111.803956
      }
    },
    {
      "id": "order_38",
      "resource": "letters",
      "address": {
        "latitude": 38.985742,
        "longitude": -104.724672
      }
    },
    {
      "id": "order_39",
      "resource": "letters",
      "address": {
        "latitude": 38.985742,
        "longitude": -104.724672
      }
    },
    {
      "id": "order_40",
      "resource": "checks",
      "address": {
        "latitude": 29.545554,
        "longitude": -95.028944
      }
    },
    {
      "id": "order_41",
      "resource": "checks",
      "address": {
        "latitude": 42.361359,
        "longitude": -73.5539
      }
    },
    {
      "id": "order_42",
      "resource": "postcards",
      "address": {
        "latitude": 27.225292,
        "longitude": -80.337969
      }
    }
  ],
  "partners": [
    {
      "id": "partner_1",
      "resource": "checks",
      "capacity": 5,
      "address": {
        "latitude": 42.651814,
        "longitude": -71.219284
      }
    },
    {
      "id": "partner_2",
      "resource": "letters",
      "capacity": 35,
      "address": {
        "latitude": 40.971844,
        "longitude": -73.695768
      }
    },
    {
      "id": "partner_3",
      "resource": "letters",
      "capacity": 13,
      "address": {
        "latitude": 39.033324,
        "longitude": -77.282924
      }
    },
    {
      "id": "partner_4",
      "resource": "postcards",
      "capacity": 30,
      "address": {
        "latitude": 25.850715,
        "longitude": -80.134119
      }
    },
    {
      "id": "partner_5",
      "resource": "checks",
      "capacity": 6,
      "address": {
        "latitude": 33.052602,
        "longitude": -117.256814
      }
    },
    {
      "id": "partner_6",
      "resource": "checks",
      "capacity": 8,
      "address": {
        "latitude": 26.102438,
        "longitude": -80.160847
      }
    },
    {
      "id": "partner_7",
      "resource": "checks",
      "capacity": 9,
      "address": {
        "latitude": 33.051634,
        "longitude": -117.256608
      }
    },
    {
      "id": "partner_8",
      "resource": "checks",
      "capacity": 5,
      "address": {
        "latitude": 25.797542,
        "longitude": -80.143762
      }
    },
    {
      "id": "partner_9",
      "resource": "letters",
      "capacity": 3,
      "address": {
        "latitude": 36.62506,
        "longitude": -82.090872
      }
    },
    {
      "id": "partner_10",
      "resource": "postcards",
      "capacity": 20,
      "address": {
        "latitude": 33.050952,
        "longitude": -117.256623
      }
    }
  ]
}

const getDistance = (o: { longitude: number, latitude: number }, p: { longitude: number, latitude: number }): number => {

  const first = Math.pow(o.longitude - p.longitude, 2);
  const second = Math.pow(o.latitude - p.latitude, 2);

  return Math.pow(first + second, 1/2);
};

export const routeOrders = (ordersAndParters: OrdersAndPartners) => {

  const partners = ordersAndParters.partners.map(v => {
    return {currentCapacity: 0, ...v}
  });

  const orders = ordersAndParters.orders;

  for (let o of orders) {

    let partner = null, minDistance = null;

    for (let p of partners) {

      if (o.resource !== p.resource) {
        continue;
      }

      if (p.currentCapacity >= p.capacity) {
        continue;
      }

      if (partner === null) {
        partner = p;
        minDistance = getDistance(o.address, p.address);
        continue;
      }

      const newMinDistance = getDistance(o.address, p.address);

      if (newMinDistance <= minDistance) {
        partner = p;
        minDistance = newMinDistance;
      }

    }

    if (partner) {
      partner.currentCapacity++;
      console.log(o.id + ':', partner.id);
    }

  }

};

console.error(
  // partner 10 + order 3
  getDistance({
      "latitude": 33.050952,
      "longitude": -117.256623
    },
    {
      "latitude": 37.961643,
      "longitude": -107.885334
    }
  )
);

console.error(
  // partner 4 + order 3
  getDistance(
    {
      "latitude": 25.850715,
      "longitude": -80.134119
    },
    {
      "latitude": 37.961643,
      "longitude": -107.885334
    }
  )
);


routeOrders(
  {
    "orders": [
      {
        "id": "order_1",
        "resource": "postcards",
        "address": {
          "latitude": 41.005544,
          "longitude": -73.876138
        }
      },
      {
        "id": "order_2",
        "resource": "postcards",
        "address": {
          "latitude": 28.7024,
          "longitude": -81.452995
        }
      },
      {
        "id": "order_3",
        "resource": "postcards",
        "address": {
          "latitude": 37.961643,
          "longitude": -107.885334
        }
      },
      {
        "id": "order_4",
        "resource": "checks",
        "address": {
          "latitude": 37.928943,
          "longitude": -107.859192
        }
      },
      {
        "id": "order_5",
        "resource": "letters",
        "address": {
          "latitude": 33.04665,
          "longitude": -117.250184
        }
      },
      {
        "id": "order_6",
        "resource": "postcards",
        "address": {
          "latitude": 39.891943,
          "longitude": -75.699625
        }
      },
      {
        "id": "order_7",
        "resource": "letters",
        "address": {
          "latitude": 34.436576,
          "longitude": -119.163465
        }
      },
      {
        "id": "order_8",
        "resource": "letters",
        "address": {
          "latitude": 30.211633,
          "longitude": -97.938092
        }
      },
      {
        "id": "order_9",
        "resource": "checks",
        "address": {
          "latitude": 35.262878,
          "longitude": -82.140506
        }
      },
      {
        "id": "order_10",
        "resource": "checks",
        "address": {
          "latitude": 33.446482,
          "longitude": -83.198236
        }
      },
      {
        "id": "order_11",
        "resource": "letters",
        "address": {
          "latitude": 32.891607,
          "longitude": -96.823646
        }
      },
      {
        "id": "order_12",
        "resource": "postcards",
        "address": {
          "latitude": 33.675769,
          "longitude": -111.850623
        }
      },
      {
        "id": "order_13",
        "resource": "letters",
        "address": {
          "latitude": 26.62785,
          "longitude": -80.218898
        }
      },
      {
        "id": "order_14",
        "resource": "letters",
        "address": {
          "latitude": 34.18078,
          "longitude": -118.806614
        }
      },
      {
        "id": "order_15",
        "resource": "letters",
        "address": {
          "latitude": 34.18078,
          "longitude": -118.806614
        }
      },
      {
        "id": "order_16",
        "resource": "letters",
        "address": {
          "latitude": 32.891607,
          "longitude": -96.823646
        }
      },
      {
        "id": "order_17",
        "resource": "postcards",
        "address": {
          "latitude": 45.868978,
          "longitude": -111.058772
        }
      },
      {
        "id": "order_18",
        "resource": "checks",
        "address": {
          "latitude": 40.046623,
          "longitude": -74.048201
        }
      },
      {
        "id": "order_19",
        "resource": "letters",
        "address": {
          "latitude": 33.675769,
          "longitude": -111.850623
        }
      },
      {
        "id": "order_20",
        "resource": "checks",
        "address": {
          "latitude": 37.958991,
          "longitude": -107.873763
        }
      },
      {
        "id": "order_21",
        "resource": "checks",
        "address": {
          "latitude": 47.618555,
          "longitude": -122.28382
        }
      },
      {
        "id": "order_22",
        "resource": "checks",
        "address": {
          "latitude": 40.763951,
          "longitude": -73.967857
        }
      },
      {
        "id": "order_23",
        "resource": "postcards",
        "address": {
          "latitude": 33.628883,
          "longitude": -117.954707
        }
      },
      {
        "id": "order_24",
        "resource": "checks",
        "address": {
          "latitude": 33.685758,
          "longitude": -116.399214
        }
      },
      {
        "id": "order_25",
        "resource": "letters",
        "address": {
          "latitude": 39.309428,
          "longitude": -74.52928
        }
      },
      {
        "id": "order_26",
        "resource": "letters",
        "address": {
          "latitude": 29.525413,
          "longitude": -95.212941
        }
      },
      {
        "id": "order_27",
        "resource": "checks",
        "address": {
          "latitude": 42.497946,
          "longitude": -71.374363
        }
      },
      {
        "id": "order_28",
        "resource": "letters",
        "address": {
          "latitude": 25.854061,
          "longitude": -80.144928
        }
      },
      {
        "id": "order_29",
        "resource": "letters",
        "address": {
          "latitude": 34.470627,
          "longitude": -119.990909
        }
      },
      {
        "id": "order_30",
        "resource": "letters",
        "address": {
          "latitude": 26.750975,
          "longitude": -80.036365
        }
      },
      {
        "id": "order_31",
        "resource": "postcards",
        "address": {
          "latitude": 32.893501,
          "longitude": -96.825466
        }
      },
      {
        "id": "order_32",
        "resource": "postcards",
        "address": {
          "latitude": 36.592363,
          "longitude": -121.957976
        }
      },
      {
        "id": "order_33",
        "resource": "letters",
        "address": {
          "latitude": 26.102093,
          "longitude": -81.788913
        }
      },
      {
        "id": "order_34",
        "resource": "letters",
        "address": {
          "latitude": 40.733666,
          "longitude": -111.532391
        }
      },
      {
        "id": "order_35",
        "resource": "postcards",
        "address": {
          "latitude": 43.120214,
          "longitude": -89.378063
        }
      },
      {
        "id": "order_36",
        "resource": "postcards",
        "address": {
          "latitude": 32.893652,
          "longitude": -96.819079
        }
      },
      {
        "id": "order_37",
        "resource": "postcards",
        "address": {
          "latitude": 40.554752,
          "longitude": -111.803956
        }
      },
      {
        "id": "order_38",
        "resource": "letters",
        "address": {
          "latitude": 38.985742,
          "longitude": -104.724672
        }
      },
      {
        "id": "order_39",
        "resource": "letters",
        "address": {
          "latitude": 38.985742,
          "longitude": -104.724672
        }
      },
      {
        "id": "order_40",
        "resource": "checks",
        "address": {
          "latitude": 29.545554,
          "longitude": -95.028944
        }
      },
      {
        "id": "order_41",
        "resource": "checks",
        "address": {
          "latitude": 42.361359,
          "longitude": -73.5539
        }
      },
      {
        "id": "order_42",
        "resource": "postcards",
        "address": {
          "latitude": 27.225292,
          "longitude": -80.337969
        }
      }
    ],
    "partners": [
      {
        "id": "partner_1",
        "resource": "checks",
        "capacity": 5,
        "address": {
          "latitude": 42.651814,
          "longitude": -71.219284
        }
      },
      {
        "id": "partner_2",
        "resource": "letters",
        "capacity": 35,
        "address": {
          "latitude": 40.971844,
          "longitude": -73.695768
        }
      },
      {
        "id": "partner_3",
        "resource": "letters",
        "capacity": 13,
        "address": {
          "latitude": 39.033324,
          "longitude": -77.282924
        }
      },
      {
        "id": "partner_4",
        "resource": "postcards",
        "capacity": 30,
        "address": {
          "latitude": 25.850715,
          "longitude": -80.134119
        }
      },
      {
        "id": "partner_5",
        "resource": "checks",
        "capacity": 6,
        "address": {
          "latitude": 33.052602,
          "longitude": -117.256814
        }
      },
      {
        "id": "partner_6",
        "resource": "checks",
        "capacity": 8,
        "address": {
          "latitude": 26.102438,
          "longitude": -80.160847
        }
      },
      {
        "id": "partner_7",
        "resource": "checks",
        "capacity": 9,
        "address": {
          "latitude": 33.051634,
          "longitude": -117.256608
        }
      },
      {
        "id": "partner_8",
        "resource": "checks",
        "capacity": 5,
        "address": {
          "latitude": 25.797542,
          "longitude": -80.143762
        }
      },
      {
        "id": "partner_9",
        "resource": "letters",
        "capacity": 3,
        "address": {
          "latitude": 36.62506,
          "longitude": -82.090872
        }
      },
      {
        "id": "partner_10",
        "resource": "postcards",
        "capacity": 20,
        "address": {
          "latitude": 33.050952,
          "longitude": -117.256623
        }
      }
    ]
  }
);
